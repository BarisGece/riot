<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Julien Ruaux">
<title>RIOT Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>RIOT Guide</h1>
<div class="details">
<span id="author" class="author">Julien Ruaux</span><br>
<span id="revnumber">version 2.12.1-SNAPSHOT</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_riot_db">2. RIOT DB</a>
<ul class="sectlevel2">
<li><a href="#_getting_started">2.1. Getting Started</a>
<ul class="sectlevel3">
<li><a href="#_install">2.1.1. Install</a></li>
<li><a href="#_usage">2.1.2. Usage</a></li>
</ul>
</li>
<li><a href="#_drivers">2.2. Drivers</a></li>
<li><a href="#_importing">2.3. Importing</a>
<ul class="sectlevel3">
<li><a href="#_redis_commands">2.3.1. Redis Commands</a></li>
<li><a href="#_processing">2.3.2. Processing</a></li>
</ul>
</li>
<li><a href="#_exporting">2.4. Exporting</a></li>
</ul>
</li>
<li><a href="#_riot_file">3. RIOT File</a>
<ul class="sectlevel2">
<li><a href="#_getting_started_2">3.1. Getting Started</a>
<ul class="sectlevel3">
<li><a href="#_install_2">3.1.1. Install</a></li>
<li><a href="#_usage_2">3.1.2. Usage</a></li>
</ul>
</li>
<li><a href="#_importing_2">3.2. Importing</a>
<ul class="sectlevel3">
<li><a href="#_paths">3.2.1. Paths</a></li>
<li><a href="#_formats">3.2.2. Formats</a></li>
<li><a href="#_redis_commands_2">3.2.3. Redis Commands</a></li>
<li><a href="#_processing_2">3.2.4. Processing</a></li>
</ul>
</li>
<li><a href="#_exporting_2">3.3. Exporting</a></li>
</ul>
</li>
<li><a href="#_riot_gen">4. RIOT Gen</a>
<ul class="sectlevel2">
<li><a href="#_getting_started_3">4.1. Getting Started</a>
<ul class="sectlevel3">
<li><a href="#_install_3">4.1.1. Install</a></li>
<li><a href="#_usage_3">4.1.2. Usage</a></li>
</ul>
</li>
<li><a href="#_importing_3">4.2. Importing</a>
<ul class="sectlevel3">
<li><a href="#_redis_commands_3">4.2.1. Redis Commands</a></li>
<li><a href="#_processing_3">4.2.2. Processing</a></li>
<li><a href="#_redisearch">4.2.3. RediSearch</a></li>
</ul>
</li>
<li><a href="#_faker_fields">4.3. Faker Fields</a></li>
</ul>
</li>
<li><a href="#_riot_redis">5. RIOT Redis</a>
<ul class="sectlevel2">
<li><a href="#_getting_started_4">5.1. Getting Started</a>
<ul class="sectlevel3">
<li><a href="#_install_4">5.1.1. Install</a></li>
<li><a href="#_usage_4">5.1.2. Usage</a></li>
</ul>
</li>
<li><a href="#_replicating">5.2. Replicating</a>
<ul class="sectlevel3">
<li><a href="#_type_based_replication">5.2.1. Type-Based Replication</a></li>
<li><a href="#_verification">5.2.2. Verification</a></li>
</ul>
</li>
<li><a href="#_architecture">5.3. Architecture</a>
<ul class="sectlevel3">
<li><a href="#_producer">5.3.1. Producer</a></li>
<li><a href="#_consumer">5.3.2. Consumer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_riot_stream">6. RIOT Stream</a>
<ul class="sectlevel2">
<li><a href="#_getting_started_5">6.1. Getting Started</a>
<ul class="sectlevel3">
<li><a href="#_install_5">6.1.1. Install</a></li>
<li><a href="#_usage_5">6.1.2. Usage</a></li>
</ul>
</li>
<li><a href="#_importing_4">6.2. Importing</a></li>
<li><a href="#_exporting_3">6.3. Exporting</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Redis Input/Output Tools (RIOT) is a series of utilities designed to help you get data in and out of Redis:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="index.html#_riot_db">RIOT DB</a>: Import/export SQL databases</p>
</li>
<li>
<p><a href="index.html#_riot_file">RIOT File</a>: Import/export CSV, JSON, XML files</p>
</li>
<li>
<p><a href="index.html#_riot_gen">RIOT Gen</a>: Data generator</p>
</li>
<li>
<p><a href="index.html#_riot_redis">RIOT Redis</a>: Redis to Redis live replication</p>
</li>
<li>
<p><a href="index.html#_riot_stream">RIOT Stream</a>: Import/export Kafka messages</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_riot_db"><a class="anchor" href="#_riot_db"></a>2. RIOT DB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RIOT DB lets you import and export data from relational databases.</p>
</div>
<div class="sect2">
<h3 id="_getting_started"><a class="anchor" href="#_getting_started"></a>2.1. Getting Started</h3>
<div class="sect3">
<h4 id="_install"><a class="anchor" href="#_install"></a>2.1.1. Install</h4>
<div class="paragraph">
<p>RIOT DB can be installed in different ways depending on your environment and preference.</p>
</div>
<div class="sect4">
<h5 id="_download_and_run"><a class="anchor" href="#_download_and_run"></a>Download and Run</h5>
<div class="paragraph">
<p>Download the <a href="https://github.com/redis-developer/riot/releases/latest">latest release</a>, unzip and copy to the desired location.</p>
</div>
<div class="paragraph">
<p>Launch the <code>bin/riot-db</code> script and follow the usage information provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="_homebrew_macos"><a class="anchor" href="#_homebrew_macos"></a>Homebrew (macOS)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">brew install redis-developer/tap/riot-db</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_scoop_windows"><a class="anchor" href="#_scoop_windows"></a>Scoop (Windows)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">scoop bucket add redis-developer https://github.com/redis-developer/scoop.git
scoop install riot-db</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_clone_and_run"><a class="anchor" href="#_clone_and_run"></a>Clone and run</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">git clone https://github.com/redis-developer/riot.git
cd riot/bin
./riot-db</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a>2.1.2. Usage</h4>
<div class="paragraph">
<p>To display usage help, run the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-db</span> --help
Usage: <strong>riot-db</strong> [OPTIONS] [COMMAND]
  <span class="olive">-H</span>, <span class="olive">--help</span>                Show this help message and exit
  <span class="olive">-V</span>, <span class="olive">--version</span>             Print version information and exit.
  <span class="olive">-q</span>, <span class="olive">--quiet</span>               Log errors only.
  <span class="olive">-w</span>, <span class="olive">--warn</span>                Set log level to warn.
  <span class="olive">-i</span>, <span class="olive">--info</span>                Set log level to info.
  <span class="olive">-d</span>, <span class="olive">--debug</span>               Log in debug mode (includes normal stacktrace).
      <span class="olive">--stacktrace</span>          Print out the stacktrace for all exceptions.
Redis connection options
  <span class="olive">-h</span>, <span class="olive">--hostname</span>=&lt;host&gt;     Server hostname (default: localhost).
  <span class="olive">-p</span>, <span class="olive">--port</span>=&lt;port&gt;         Server port (default: 6379).
  <span class="olive">-s</span>, <span class="olive">--socket</span>=&lt;socket&gt;     Server socket (overrides hostname and port).
      <span class="olive">--user</span>=&lt;name&gt;         Used to send ACL style 'AUTH username pass'. Needs password.
  <span class="olive">-a</span>, <span class="olive">--pass</span>[=&lt;password&gt;]   Password to use when connecting to the server.
  <span class="olive">-u</span>, <span class="olive">--uri</span>=&lt;uri&gt;...        Server URI.
      --timeout=&lt;sec&gt;       Redis command timeout (default: 60).
  <span class="olive">-n</span>, <span class="olive">--db</span>=&lt;db&gt;             Database number (default: 0).
  <span class="olive">-c</span>, <span class="olive">--cluster</span>             Enable cluster mode.
      <span class="olive">--tls</span>                 Establish a secure TLS connection.
      <span class="olive">--[no-]verify-peer</span>    Verify peers when using TLS. True by default.
      <span class="olive">--latency</span>             Show latency metrics.
      <span class="olive">--pool-max</span>=&lt;int&gt;      Max pool connections (default: 8).
      <span class="olive">--client</span>=&lt;name&gt;       Client name used to connect to Redis.
Commands:
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>Redis connection options are the same as <code>redis-cli</code>.</p>
</div>
<div class="paragraph">
<p>For Redis URI syntax see <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details#uri-syntax">here</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use <code>--help</code> on any subcommand:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-db</span> import --help
<span class="green">riot-db</span> import hset --help</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drivers"><a class="anchor" href="#_drivers"></a>2.2. Drivers</h3>
<div class="paragraph">
<p>RIOT DB includes drivers for the most common RDBMSs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.oracle.com/cd/E11882_01/appdev.112/e13995/oracle/jdbc/OracleDriver.html">Oracle</a></p>
<div class="paragraph">
<p><code>jdbc:oracle:thin:@myhost:1521:orcl</code></p>
</div>
</li>
<li>
<p><a href="https://www.ibm.com/support/knowledgecenter/en/SSEPGG_11.5.0/com.ibm.db2.luw.apdv.java.doc/src/tpc/imjcc_r0052342.html">IBM Db2</a></p>
<div class="paragraph">
<p><code>jdbc:db2://host:port/database</code></p>
</div>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/sql/connect/jdbc/building-the-connection-url?view=sql-server-2017">MS SQL Server</a></p>
<div class="paragraph">
<p><code>jdbc:sqlserver://[serverName[\instanceName][:portNumber]][;property=value[;property=value]]</code></p>
</div>
</li>
<li>
<p><a href="https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-reference-jdbc-url-format.html">MySQL</a></p>
<div class="paragraph">
<p><code>jdbc:mysql://[host]:[port][/database][?properties]</code></p>
</div>
</li>
<li>
<p><a href="https://www.postgresql.org/docs/7.4/jdbc-use.html">PostgreSQL</a></p>
<div class="paragraph">
<p><code>jdbc:postgresql://host:port/database</code></p>
</div>
</li>
<li>
<p><a href="https://www.sqlitetutorial.net/sqlite-java/sqlite-jdbc-driver/">SQLite</a></p>
<div class="paragraph">
<p><code>jdbc:sqlite:sqlite_database_file_path</code></p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For non-included databases you must install the corresponding JDBC driver under the <code>lib</code> directory and modify the <code>CLASSPATH</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>*nix: <code>bin/riot-db</code> &#8594; <code>CLASSPATH=$APP_HOME/lib/myjdbc.jar:$APP_HOME/lib/&#8230;&#8203;</code></p>
</li>
<li>
<p>Windows: <code>bin\riot-db.bat</code> &#8594; <code>set CLASSPATH=%APP_HOME%\lib\myjdbc.jar;%APP_HOME%\lib...</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_importing"><a class="anchor" href="#_importing"></a>2.3. Importing</h3>
<div class="paragraph">
<p>The <code>import</code> command reads rows from a SQL resultset and writes them to Redis. The general usage is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span class="green">riot-db</span> -h &lt;redis host&gt; -p &lt;redis port&gt; import --url &lt;jdbc url&gt; <span class="olive">SQL</span> [REDIS COMMAND...]</pre>
</div>
</div>
<div class="paragraph">
<p>To show the full usage, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span class="green">riot-db</span> import --help</pre>
</div>
</div>
<div class="listingblock">
<div class="title">PostgreSQL Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-db import &quot;SELECT * FROM orders&quot; --url &quot;jdbc:postgresql://host:port/database&quot; --username appuser --password passwd hset --keyspace order --keys order_id</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_redis_commands"><a class="anchor" href="#_redis_commands"></a>2.3.1. Redis Commands</h4>
<div class="paragraph">
<p>Redis keys are constructed from input records by concatenating the keyspace prefix and key fields:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mapping.png" alt="mapping">
</div>
</div>
<div class="paragraph">
<p>You can specify one or many Redis commands as targets of the import:</p>
</div>
<div class="literalblock">
<div class="title">Import into hashes</div>
<div class="content">
<pre><span class="green">riot-db</span> import ... <strong class="olive">hset</strong> --keyspace blah --keys id</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Import into hashes <strong>and</strong> set TTL on the key</div>
<div class="content">
<pre><span class="green">riot-db</span> import ... <strong class="olive">hset</strong> --keyspace blah --keys id <strong class="olive">expire</strong> --keyspace blah --keys id</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Import into hashes <strong>and</strong> set TTL <strong>and</strong> add to a set named <code>myset</code></div>
<div class="content">
<pre><span class="green">riot-db</span> import ... <strong class="olive">hset</strong> --keyspace blah --keys id <strong class="olive">expire</strong> --keyspace blah --keys id <strong class="olive">sadd</strong> --keyspace myset --members id</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Redis connection options apply to the root command (riot-db) and not to subcommands.</p>
</div>
<div class="paragraph">
<p>In this example the redis options will not be taken into account:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-db</span> import ... <strong class="olive">hset</strong> <span class="line-through"><strong class="red">-h myredis.com -p 6380</strong></span></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_processing"><a class="anchor" href="#_processing"></a>2.3.2. Processing</h4>
<div class="paragraph">
<p>The following processors can be applied to records in that order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transforms</p>
</li>
<li>
<p>Regular expressions</p>
</li>
<li>
<p>Filters</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_transforms"><a class="anchor" href="#_transforms"></a>Transforms</h5>
<div class="paragraph">
<p>Transforms allow you to create/update/delete fields using the <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions">Spring Expression Language</a> (SpEL):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>field1='foo'</code> &#8594; generate a field named <code>field1</code> containing the string <code>foo</code></p>
</li>
<li>
<p><code>temp=(temp-32)*5/9</code> &#8594; convert temperature from Fahrenheit to Celsius</p>
</li>
<li>
<p><code>name=remove(first).concat(remove(last))</code> &#8594; concatenate <code>first</code> and <code>last</code> fields and delete them</p>
</li>
<li>
<p><code>field2=null</code> &#8594; delete <code>field2</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Input fields are accessed by name (e.g. <code>field3=field1+field2</code>).</p>
</div>
<div class="paragraph">
<p>The transform processor also exposes functions and variables that can be accessed using the <code>#</code> prefix:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>date</code></dt>
<dd>
<p>Date parser/formatter (<a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html">API doc</a>)</p>
</dd>
<dt class="hdlist1"><code>geo</code></dt>
<dd>
<p>Convenience method that takes a longitude and a latitude to produce a RediSearch geo-location string in the form: <code>longitude,latitude</code></p>
</dd>
<dt class="hdlist1"><code>index</code></dt>
<dd>
<p>Sequence number of the item being generated</p>
</dd>
<dt class="hdlist1"><code>redis</code></dt>
<dd>
<p>Handle to invoke Redis commands (<a href="https://lettuce.io/core/release/api/io/lettuce/core/api/sync/RedisCommands.html">API doc</a>)</p>
</dd>
</dl>
</div>
<div class="literalblock">
<div class="title">Processor Example</div>
<div class="content">
<pre><span class="green">riot-db</span> import --process epoch=<span class="olive">"#date.parse(mydate).getTime()"</span> location=<span class="olive">"#geo(lon,lat)"</span> id=<span class="olive">"#index"</span> name=<span class="olive">"#redis.hget('person1','lastName')"</span> ...</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_regular_expressions"><a class="anchor" href="#_regular_expressions"></a>Regular Expressions</h5>
<div class="paragraph">
<p>Extract patterns from source fields using regular expressions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-db</span> import --regex name=<span class="olive">"(?<first>\w+)\/(?<last>\w+)"</span> ...</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_filters"><a class="anchor" href="#_filters"></a>Filters</h5>
<div class="paragraph">
<p>Keep records that match a SpEL boolean expression.</p>
</div>
<div class="paragraph">
<p>For example this filter will only keep records where the <code>value</code> field is a series of digits:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-db</span> import --filter "value matches '\\d+'" ...</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporting"><a class="anchor" href="#_exporting"></a>2.4. Exporting</h3>
<div class="paragraph">
<p>The <code>export</code> command reads data from a Redis database and writes it to a SQL database. The general usage is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span class="green">riot-db</span> -h &lt;redis host&gt; -p &lt;redis port&gt; export --url &lt;jdbc url&gt; <span class="olive">SQL</span></pre>
</div>
</div>
<div class="paragraph">
<p>To show the full usage, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span class="green">riot-db</span> export --help</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Export to PostgreSQL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-db export &quot;INSERT INTO mytable (id, field1, field2) VALUES (CAST(:id AS SMALLINT), :field1, :field2)&quot; --url &quot;jdbc:postgresql://host:port/database&quot; --username appuser --password passwd --match &quot;hash:*&quot; --key-regex &quot;hash:(?&lt;id&gt;.*)&quot;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Import from PostgreSQL to JSON strings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-db import &quot;SELECT * FROM orders&quot; --url &quot;jdbc:postgresql://host:port/database&quot; --username appuser --password passwd set --keyspace order --keys order_id</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will produce Redis strings that look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">order_id</span><span class="delimiter">&quot;</span></span>: <span class="integer">10248</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">customer_id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">VINET</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">employee_id</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">order_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1996-07-04</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">required_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1996-08-01</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">shipped_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1996-07-16</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">ship_via</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">freight</span><span class="delimiter">&quot;</span></span>: <span class="float">32.38</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">ship_name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Vins et alcools Chevalier</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">ship_address</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">59 rue de l'Abbaye</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">ship_city</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Reims</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">ship_postal_code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">51100</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">ship_country</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">France</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_riot_file"><a class="anchor" href="#_riot_file"></a>3. RIOT File</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RIOT File lets you import and export local or remote files in many formats like CSV, JSON, and XML.</p>
</div>
<div class="sect2">
<h3 id="_getting_started_2"><a class="anchor" href="#_getting_started_2"></a>3.1. Getting Started</h3>
<div class="sect3">
<h4 id="_install_2"><a class="anchor" href="#_install_2"></a>3.1.1. Install</h4>
<div class="paragraph">
<p>RIOT File can be installed in different ways depending on your environment and preference.</p>
</div>
<div class="sect4">
<h5 id="_download_and_run_2"><a class="anchor" href="#_download_and_run_2"></a>Download and Run</h5>
<div class="paragraph">
<p>Download the <a href="https://github.com/redis-developer/riot/releases/latest">latest release</a>, unzip and copy to the desired location.</p>
</div>
<div class="paragraph">
<p>Launch the <code>bin/riot-file</code> script and follow the usage information provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="_homebrew_macos_2"><a class="anchor" href="#_homebrew_macos_2"></a>Homebrew (macOS)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">brew install redis-developer/tap/riot-file</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_scoop_windows_2"><a class="anchor" href="#_scoop_windows_2"></a>Scoop (Windows)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">scoop bucket add redis-developer https://github.com/redis-developer/scoop.git
scoop install riot-file</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_clone_and_run_2"><a class="anchor" href="#_clone_and_run_2"></a>Clone and run</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">git clone https://github.com/redis-developer/riot.git
cd riot/bin
./riot-file</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage_2"><a class="anchor" href="#_usage_2"></a>3.1.2. Usage</h4>
<div class="paragraph">
<p>To display usage help, run the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> --help
Usage: <strong>riot-file</strong> [OPTIONS] [COMMAND]
  <span class="olive">-H</span>, <span class="olive">--help</span>                Show this help message and exit
  <span class="olive">-V</span>, <span class="olive">--version</span>             Print version information and exit.
  <span class="olive">-q</span>, <span class="olive">--quiet</span>               Log errors only.
  <span class="olive">-w</span>, <span class="olive">--warn</span>                Set log level to warn.
  <span class="olive">-i</span>, <span class="olive">--info</span>                Set log level to info.
  <span class="olive">-d</span>, <span class="olive">--debug</span>               Log in debug mode (includes normal stacktrace).
      <span class="olive">--stacktrace</span>          Print out the stacktrace for all exceptions.
Redis connection options
  <span class="olive">-h</span>, <span class="olive">--hostname</span>=&lt;host&gt;     Server hostname (default: localhost).
  <span class="olive">-p</span>, <span class="olive">--port</span>=&lt;port&gt;         Server port (default: 6379).
  <span class="olive">-s</span>, <span class="olive">--socket</span>=&lt;socket&gt;     Server socket (overrides hostname and port).
      <span class="olive">--user</span>=&lt;name&gt;         Used to send ACL style 'AUTH username pass'. Needs password.
  <span class="olive">-a</span>, <span class="olive">--pass</span>[=&lt;password&gt;]   Password to use when connecting to the server.
  <span class="olive">-u</span>, <span class="olive">--uri</span>=&lt;uri&gt;...        Server URI.
      --timeout=&lt;sec&gt;       Redis command timeout (default: 60).
  <span class="olive">-n</span>, <span class="olive">--db</span>=&lt;db&gt;             Database number (default: 0).
  <span class="olive">-c</span>, <span class="olive">--cluster</span>             Enable cluster mode.
      <span class="olive">--tls</span>                 Establish a secure TLS connection.
      <span class="olive">--[no-]verify-peer</span>    Verify peers when using TLS. True by default.
      <span class="olive">--latency</span>             Show latency metrics.
      <span class="olive">--pool-max</span>=&lt;int&gt;      Max pool connections (default: 8).
      <span class="olive">--client</span>=&lt;name&gt;       Client name used to connect to Redis.
Commands:
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>Redis connection options are the same as <code>redis-cli</code>.</p>
</div>
<div class="paragraph">
<p>For Redis URI syntax see <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details#uri-syntax">here</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use <code>--help</code> on any subcommand:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> import --help
<span class="green">riot-file</span> import hset --help</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_importing_2"><a class="anchor" href="#_importing_2"></a>3.2. Importing</h3>
<div class="paragraph">
<p>The <code>import</code> command reads data from files and writes it to Redis. The general usage is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> -h <host> -p <port> import <span class="olive">FILE</span>... [REDIS COMMAND...]</pre>
</div>
</div>
<div class="paragraph">
<p>To show the full usage, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> import --help</pre>
</div>
</div>
<div class="sect3">
<h4 id="_paths"><a class="anchor" href="#_paths"></a>3.2.1. Paths</h4>
<div class="paragraph">
<p>Paths can include <a href="https://man7.org/linux/man-pages/man7/glob.7.html">wildcard patterns</a>.</p>
</div>
<div class="paragraph">
<p>RIOT File will try to determine the file type from its extension (e.g. <code>.csv</code> or <code>.json</code>), but you can specify it explicity using the <code>--filetype</code> option.</p>
</div>
<div class="paragraph">
<p>Gzipped files are supported and the extension before <code>.gz</code> is used (e.g. <code>myfile.json.gz</code> &#8594; JSON type).</p>
</div>
<div class="ulist">
<div class="title">Examples</div>
<ul>
<li>
<p><code>/path/file.csv</code></p>
</li>
<li>
<p><code>/path/file-*.csv</code></p>
</li>
<li>
<p><code>/path/file.json</code></p>
</li>
<li>
<p><code>http://data.com/file.csv</code></p>
</li>
<li>
<p><code>http://data.com/file.json.gz</code></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use <code>-</code> to read from standard input.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For AWS S3 buckets you can specify access and secret keys as well as the region for the bucket.</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> import s3://my-bucket/path/file.json --s3-region us-west-1 --s3-access xxxxxx --s3-secret xxxxxx</pre>
</div>
</div>
<div class="paragraph">
<p>For Google Cloud Storage you can specify credentials and project id for the bucket:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> import gs://my-bucket/path/file.json --gcs-key-file key.json --gcs-project-id my-gcp-project</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_formats"><a class="anchor" href="#_formats"></a>3.2.2. Formats</h4>
<div class="paragraph">
<p>RIOT File supports a variety of file formats that can be imported into Redis:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delimited (CSV, TSV, PSV)</p>
</li>
<li>
<p>Fixed-length aka fixed-width</p>
</li>
<li>
<p>JSON</p>
</li>
<li>
<p>XML</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For flat file formats (delimited and fixed-length) you can use the <code>--header</code> option to automatically extract field names from the header. Otherwise specify the field names using the <code>--fields</code> option.</p>
</div>
<div class="sect4">
<h5 id="_delimited"><a class="anchor" href="#_delimited"></a>Delimited</h5>
<div class="paragraph">
<p>The default delimiter character is comma (<code>,</code>). It can be changed with the <code>--delimiter</code> option.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider this CSV file:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">Table 1. <a href="https://raw.githubusercontent.com/nickhould/craft-beers-dataset/master/data/processed/beers.csv">beers.csv</a></caption>
<colgroup>
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 7.619%;">
<col style="width: 6.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">abv</th>
<th class="tableblock halign-left valign-top">ibu</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">style</th>
<th class="tableblock halign-left valign-top">brewery_id</th>
<th class="tableblock halign-left valign-top">ounces</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.05</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1436</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pub Beer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">American Pale Lager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">408</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.066</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2265</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devil&#8217;s Cup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">American Pale Ale (APA)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">177</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.071</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2264</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rise of the Phoenix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">American IPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">177</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following command imports that CSV file into Redis as hashes using <code>beer</code> as the key prefix and <code>id</code> as primary key. This creates hashes with keys <code>beer:1436</code>, <code>beer:2265</code>, &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-file import http://developer.redislabs.com/riot/beers.csv --header hset --keyspace beer --keys id</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command imports a CSV file into a geo set named <code>airportgeo</code> with airport IDs as members:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-file import http://developer.redislabs.com/riot/airports.csv --header --skip-limit 1 geoadd --keyspace airportgeo --members AirportID --lon Longitude --lat Latitude</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fixed_length"><a class="anchor" href="#_fixed_length"></a>Fixed-Length</h5>
<div class="paragraph">
<p>Fixed-length files can be imported by specifying the width of each field using the <code>--ranges</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-file import http://developer.redislabs.com/riot/accounts.fw --ranges 1 9 25 41 53 67 83 --header hset --keyspace account --keys Account</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_json"><a class="anchor" href="#_json"></a>JSON</h5>
<div class="paragraph">
<p>The expected format for JSON files is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>
  }
]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON import example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-file import http://developer.redislabs.com/riot/beers.json hset --keyspace beer --keys id</code></pre>
</div>
</div>
<div class="paragraph">
<p>JSON records are trees with potentially nested values that need to be flattened when the target is a Redis hash for example.</p>
</div>
<div class="paragraph">
<p>To that end, RIOT File uses a field naming convention to flatten JSON objects and arrays:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">Table 2. Nested object</caption>
<colgroup>
<col style="width: 45%;">
<col style="width: 10%;">
<col style="width: 45%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>{ "field": { "sub": "value" } }</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8594;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>field.sub=value</code></code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">Table 3. Array</caption>
<colgroup>
<col style="width: 45%;">
<col style="width: 10%;">
<col style="width: 45%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>{ "field": [1, 2, 3] }</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8594;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>field[0]=1 field[1]=2 field[2]=3</code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_xml"><a class="anchor" href="#_xml"></a>XML</h5>
<div class="paragraph">
<p>Here is a sample XML file that can be imported by RIOT File:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;records&gt;</span>
    <span class="tag">&lt;trade&gt;</span>
        <span class="tag">&lt;isin&gt;</span>XYZ0001<span class="tag">&lt;/isin&gt;</span>
        <span class="tag">&lt;quantity&gt;</span>5<span class="tag">&lt;/quantity&gt;</span>
        <span class="tag">&lt;price&gt;</span>11.39<span class="tag">&lt;/price&gt;</span>
        <span class="tag">&lt;customer&gt;</span>Customer1<span class="tag">&lt;/customer&gt;</span>
    <span class="tag">&lt;/trade&gt;</span>
    <span class="tag">&lt;trade&gt;</span>
        <span class="tag">&lt;isin&gt;</span>XYZ0002<span class="tag">&lt;/isin&gt;</span>
        <span class="tag">&lt;quantity&gt;</span>2<span class="tag">&lt;/quantity&gt;</span>
        <span class="tag">&lt;price&gt;</span>72.99<span class="tag">&lt;/price&gt;</span>
        <span class="tag">&lt;customer&gt;</span>Customer2c<span class="tag">&lt;/customer&gt;</span>
    <span class="tag">&lt;/trade&gt;</span>
    <span class="tag">&lt;trade&gt;</span>
        <span class="tag">&lt;isin&gt;</span>XYZ0003<span class="tag">&lt;/isin&gt;</span>
        <span class="tag">&lt;quantity&gt;</span>9<span class="tag">&lt;/quantity&gt;</span>
        <span class="tag">&lt;price&gt;</span>99.99<span class="tag">&lt;/price&gt;</span>
        <span class="tag">&lt;customer&gt;</span>Customer3<span class="tag">&lt;/customer&gt;</span>
    <span class="tag">&lt;/trade&gt;</span>
<span class="tag">&lt;/records&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">XML Import Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-file import http://developer.redislabs.com/riot/trades.xml hset --keyspace trade --keys id</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_redis_dumps"><a class="anchor" href="#_redis_dumps"></a>Redis Dumps</h5>
<div class="paragraph">
<p>RIOT File can also import Redis data structure files in JSON or XML formats (see Export &#8594; Redis to generate such files).</p>
</div>
<div class="listingblock">
<div class="title">Dump Import Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-file import-dump /tmp/redis.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_redis_commands_2"><a class="anchor" href="#_redis_commands_2"></a>3.2.3. Redis Commands</h4>
<div class="paragraph">
<p>Redis keys are constructed from input records by concatenating the keyspace prefix and key fields:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mapping.png" alt="mapping">
</div>
</div>
<div class="paragraph">
<p>You can specify one or many Redis commands as targets of the import:</p>
</div>
<div class="literalblock">
<div class="title">Import into hashes</div>
<div class="content">
<pre><span class="green">riot-file</span> import ... <strong class="olive">hset</strong> --keyspace blah --keys id</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Import into hashes <strong>and</strong> set TTL on the key</div>
<div class="content">
<pre><span class="green">riot-file</span> import ... <strong class="olive">hset</strong> --keyspace blah --keys id <strong class="olive">expire</strong> --keyspace blah --keys id</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Import into hashes <strong>and</strong> set TTL <strong>and</strong> add to a set named <code>myset</code></div>
<div class="content">
<pre><span class="green">riot-file</span> import ... <strong class="olive">hset</strong> --keyspace blah --keys id <strong class="olive">expire</strong> --keyspace blah --keys id <strong class="olive">sadd</strong> --keyspace myset --members id</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Redis connection options apply to the root command (riot-file) and not to subcommands.</p>
</div>
<div class="paragraph">
<p>In this example the redis options will not be taken into account:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> import ... <strong class="olive">hset</strong> <span class="line-through"><strong class="red">-h myredis.com -p 6380</strong></span></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_processing_2"><a class="anchor" href="#_processing_2"></a>3.2.4. Processing</h4>
<div class="paragraph">
<p>The following processors can be applied to records in that order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transforms</p>
</li>
<li>
<p>Regular expressions</p>
</li>
<li>
<p>Filters</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_transforms_2"><a class="anchor" href="#_transforms_2"></a>Transforms</h5>
<div class="paragraph">
<p>Transforms allow you to create/update/delete fields using the <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions">Spring Expression Language</a> (SpEL):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>field1='foo'</code> &#8594; generate a field named <code>field1</code> containing the string <code>foo</code></p>
</li>
<li>
<p><code>temp=(temp-32)*5/9</code> &#8594; convert temperature from Fahrenheit to Celsius</p>
</li>
<li>
<p><code>name=remove(first).concat(remove(last))</code> &#8594; concatenate <code>first</code> and <code>last</code> fields and delete them</p>
</li>
<li>
<p><code>field2=null</code> &#8594; delete <code>field2</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Input fields are accessed by name (e.g. <code>field3=field1+field2</code>).</p>
</div>
<div class="paragraph">
<p>The transform processor also exposes functions and variables that can be accessed using the <code>#</code> prefix:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>date</code></dt>
<dd>
<p>Date parser/formatter (<a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html">API doc</a>)</p>
</dd>
<dt class="hdlist1"><code>geo</code></dt>
<dd>
<p>Convenience method that takes a longitude and a latitude to produce a RediSearch geo-location string in the form: <code>longitude,latitude</code></p>
</dd>
<dt class="hdlist1"><code>index</code></dt>
<dd>
<p>Sequence number of the item being generated</p>
</dd>
<dt class="hdlist1"><code>redis</code></dt>
<dd>
<p>Handle to invoke Redis commands (<a href="https://lettuce.io/core/release/api/io/lettuce/core/api/sync/RedisCommands.html">API doc</a>)</p>
</dd>
</dl>
</div>
<div class="literalblock">
<div class="title">Processor Example</div>
<div class="content">
<pre><span class="green">riot-file</span> import --process epoch=<span class="olive">"#date.parse(mydate).getTime()"</span> location=<span class="olive">"#geo(lon,lat)"</span> id=<span class="olive">"#index"</span> name=<span class="olive">"#redis.hget('person1','lastName')"</span> ...</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_regular_expressions_2"><a class="anchor" href="#_regular_expressions_2"></a>Regular Expressions</h5>
<div class="paragraph">
<p>Extract patterns from source fields using regular expressions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> import --regex name=<span class="olive">"(?<first>\w+)\/(?<last>\w+)"</span> ...</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_filters_2"><a class="anchor" href="#_filters_2"></a>Filters</h5>
<div class="paragraph">
<p>Keep records that match a SpEL boolean expression.</p>
</div>
<div class="paragraph">
<p>For example this filter will only keep records where the <code>value</code> field is a series of digits:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> import --filter "value matches '\\d+'" ...</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporting_2"><a class="anchor" href="#_exporting_2"></a>3.3. Exporting</h3>
<div class="paragraph">
<p>The <code>export</code> command reads data from a Redis database and writes it to a JSON or XML file, potentially gzip-compressed. The general usage is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> -h <host> -p <port> export FILE</pre>
</div>
</div>
<div class="paragraph">
<p>To show the full usage, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-file</span> export --help</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Compressed JSON export example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-file export /tmp/beers.json.gz --match beer:*</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">XML export example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-file export /tmp/redis.xml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Exported file example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string:615</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ttl</span><span class="delimiter">&quot;</span></span>: <span class="integer">-1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value:615</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">STRING</span><span class="delimiter">&quot;</span></span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hash:511</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ttl</span><span class="delimiter">&quot;</span></span>: <span class="integer">-1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value511</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">field2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value511</span><span class="delimiter">&quot;</span></span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">HASH</span><span class="delimiter">&quot;</span></span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">list:1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ttl</span><span class="delimiter">&quot;</span></span>: <span class="integer">-1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">member:991</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">member:981</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">LIST</span><span class="delimiter">&quot;</span></span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">set:2</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ttl</span><span class="delimiter">&quot;</span></span>: <span class="integer">-1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">member:2</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">member:3</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">SET</span><span class="delimiter">&quot;</span></span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">zset:0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ttl</span><span class="delimiter">&quot;</span></span>: <span class="integer">-1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">member:1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">score</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>
      }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ZSET</span><span class="delimiter">&quot;</span></span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">stream:0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ttl</span><span class="delimiter">&quot;</span></span>: <span class="integer">-1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">stream</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">stream:0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1602190921109-0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value0</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">field2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value0</span><span class="delimiter">&quot;</span></span>
        }
      }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">STREAM</span><span class="delimiter">&quot;</span></span>
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_riot_gen"><a class="anchor" href="#_riot_gen"></a>4. RIOT Gen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RIOT Gen is a data generator based on <a href="https://github.com/DiUS/java-faker">Faker</a>.</p>
</div>
<div class="sect2">
<h3 id="_getting_started_3"><a class="anchor" href="#_getting_started_3"></a>4.1. Getting Started</h3>
<div class="sect3">
<h4 id="_install_3"><a class="anchor" href="#_install_3"></a>4.1.1. Install</h4>
<div class="paragraph">
<p>RIOT Gen can be installed in different ways depending on your environment and preference.</p>
</div>
<div class="sect4">
<h5 id="_download_and_run_3"><a class="anchor" href="#_download_and_run_3"></a>Download and Run</h5>
<div class="paragraph">
<p>Download the <a href="https://github.com/redis-developer/riot/releases/latest">latest release</a>, unzip and copy to the desired location.</p>
</div>
<div class="paragraph">
<p>Launch the <code>bin/riot-gen</code> script and follow the usage information provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="_homebrew_macos_3"><a class="anchor" href="#_homebrew_macos_3"></a>Homebrew (macOS)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">brew install redis-developer/tap/riot-gen</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_scoop_windows_3"><a class="anchor" href="#_scoop_windows_3"></a>Scoop (Windows)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">scoop bucket add redis-developer https://github.com/redis-developer/scoop.git
scoop install riot-gen</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_clone_and_run_3"><a class="anchor" href="#_clone_and_run_3"></a>Clone and run</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">git clone https://github.com/redis-developer/riot.git
cd riot/bin
./riot-gen</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage_3"><a class="anchor" href="#_usage_3"></a>4.1.2. Usage</h4>
<div class="paragraph">
<p>To display usage help, run the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> --help
Usage: <strong>riot-gen</strong> [OPTIONS] [COMMAND]
  <span class="olive">-H</span>, <span class="olive">--help</span>                Show this help message and exit
  <span class="olive">-V</span>, <span class="olive">--version</span>             Print version information and exit.
  <span class="olive">-q</span>, <span class="olive">--quiet</span>               Log errors only.
  <span class="olive">-w</span>, <span class="olive">--warn</span>                Set log level to warn.
  <span class="olive">-i</span>, <span class="olive">--info</span>                Set log level to info.
  <span class="olive">-d</span>, <span class="olive">--debug</span>               Log in debug mode (includes normal stacktrace).
      <span class="olive">--stacktrace</span>          Print out the stacktrace for all exceptions.
Redis connection options
  <span class="olive">-h</span>, <span class="olive">--hostname</span>=&lt;host&gt;     Server hostname (default: localhost).
  <span class="olive">-p</span>, <span class="olive">--port</span>=&lt;port&gt;         Server port (default: 6379).
  <span class="olive">-s</span>, <span class="olive">--socket</span>=&lt;socket&gt;     Server socket (overrides hostname and port).
      <span class="olive">--user</span>=&lt;name&gt;         Used to send ACL style 'AUTH username pass'. Needs password.
  <span class="olive">-a</span>, <span class="olive">--pass</span>[=&lt;password&gt;]   Password to use when connecting to the server.
  <span class="olive">-u</span>, <span class="olive">--uri</span>=&lt;uri&gt;...        Server URI.
      --timeout=&lt;sec&gt;       Redis command timeout (default: 60).
  <span class="olive">-n</span>, <span class="olive">--db</span>=&lt;db&gt;             Database number (default: 0).
  <span class="olive">-c</span>, <span class="olive">--cluster</span>             Enable cluster mode.
      <span class="olive">--tls</span>                 Establish a secure TLS connection.
      <span class="olive">--[no-]verify-peer</span>    Verify peers when using TLS. True by default.
      <span class="olive">--latency</span>             Show latency metrics.
      <span class="olive">--pool-max</span>=&lt;int&gt;      Max pool connections (default: 8).
      <span class="olive">--client</span>=&lt;name&gt;       Client name used to connect to Redis.
Commands:
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>Redis connection options are the same as <code>redis-cli</code>.</p>
</div>
<div class="paragraph">
<p>For Redis URI syntax see <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details#uri-syntax">here</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use <code>--help</code> on any subcommand:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> import --help
<span class="green">riot-gen</span> import hset --help</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_importing_3"><a class="anchor" href="#_importing_3"></a>4.2. Importing</h3>
<div class="paragraph">
<p>The <code>import</code> command generates data and writes it to Redis. The general usage is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> -h &lt;host&gt; -p &lt;port&gt; import <span class="olive">SPEL</span>... [REDIS COMMAND...]</pre>
</div>
</div>
<div class="paragraph">
<p>where SPEL is a <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions">Spring Expression Language</a> field in the form <code>field="expression"</code>.</p>
</div>
<div class="paragraph">
<p>To show the full usage, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> import --help</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Hash generator example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-gen import id=&quot;#index&quot; firstName=&quot;name.firstName&quot; lastName=&quot;name.lastName&quot; address=&quot;address.fullAddress&quot; hset --keyspace person --keys id</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Set generator example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-gen import name=&quot;gameOfThrones.character&quot; --end 1000 sadd --keyspace got:characters --members name</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_redis_commands_3"><a class="anchor" href="#_redis_commands_3"></a>4.2.1. Redis Commands</h4>
<div class="paragraph">
<p>Redis keys are constructed from input records by concatenating the keyspace prefix and key fields:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mapping.png" alt="mapping">
</div>
</div>
<div class="paragraph">
<p>You can specify one or many Redis commands as targets of the import:</p>
</div>
<div class="literalblock">
<div class="title">Import into hashes</div>
<div class="content">
<pre><span class="green">riot-gen</span> import ... <strong class="olive">hset</strong> --keyspace blah --keys id</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Import into hashes <strong>and</strong> set TTL on the key</div>
<div class="content">
<pre><span class="green">riot-gen</span> import ... <strong class="olive">hset</strong> --keyspace blah --keys id <strong class="olive">expire</strong> --keyspace blah --keys id</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Import into hashes <strong>and</strong> set TTL <strong>and</strong> add to a set named <code>myset</code></div>
<div class="content">
<pre><span class="green">riot-gen</span> import ... <strong class="olive">hset</strong> --keyspace blah --keys id <strong class="olive">expire</strong> --keyspace blah --keys id <strong class="olive">sadd</strong> --keyspace myset --members id</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Redis connection options apply to the root command (riot-gen) and not to subcommands.</p>
</div>
<div class="paragraph">
<p>In this example the redis options will not be taken into account:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> import ... <strong class="olive">hset</strong> <span class="line-through"><strong class="red">-h myredis.com -p 6380</strong></span></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_processing_3"><a class="anchor" href="#_processing_3"></a>4.2.2. Processing</h4>
<div class="paragraph">
<p>The following processors can be applied to records in that order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transforms</p>
</li>
<li>
<p>Regular expressions</p>
</li>
<li>
<p>Filters</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_transforms_3"><a class="anchor" href="#_transforms_3"></a>Transforms</h5>
<div class="paragraph">
<p>Transforms allow you to create/update/delete fields using the <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions">Spring Expression Language</a> (SpEL):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>field1='foo'</code> &#8594; generate a field named <code>field1</code> containing the string <code>foo</code></p>
</li>
<li>
<p><code>temp=(temp-32)*5/9</code> &#8594; convert temperature from Fahrenheit to Celsius</p>
</li>
<li>
<p><code>name=remove(first).concat(remove(last))</code> &#8594; concatenate <code>first</code> and <code>last</code> fields and delete them</p>
</li>
<li>
<p><code>field2=null</code> &#8594; delete <code>field2</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Input fields are accessed by name (e.g. <code>field3=field1+field2</code>).</p>
</div>
<div class="paragraph">
<p>The transform processor also exposes functions and variables that can be accessed using the <code>#</code> prefix:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>date</code></dt>
<dd>
<p>Date parser/formatter (<a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html">API doc</a>)</p>
</dd>
<dt class="hdlist1"><code>geo</code></dt>
<dd>
<p>Convenience method that takes a longitude and a latitude to produce a RediSearch geo-location string in the form: <code>longitude,latitude</code></p>
</dd>
<dt class="hdlist1"><code>index</code></dt>
<dd>
<p>Sequence number of the item being generated</p>
</dd>
<dt class="hdlist1"><code>redis</code></dt>
<dd>
<p>Handle to invoke Redis commands (<a href="https://lettuce.io/core/release/api/io/lettuce/core/api/sync/RedisCommands.html">API doc</a>)</p>
</dd>
</dl>
</div>
<div class="literalblock">
<div class="title">Processor Example</div>
<div class="content">
<pre><span class="green">riot-gen</span> import --process epoch=<span class="olive">"#date.parse(mydate).getTime()"</span> location=<span class="olive">"#geo(lon,lat)"</span> id=<span class="olive">"#index"</span> name=<span class="olive">"#redis.hget('person1','lastName')"</span> ...</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_regular_expressions_3"><a class="anchor" href="#_regular_expressions_3"></a>Regular Expressions</h5>
<div class="paragraph">
<p>Extract patterns from source fields using regular expressions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> import --regex name=<span class="olive">"(?<first>\w+)\/(?<last>\w+)"</span> ...</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_filters_3"><a class="anchor" href="#_filters_3"></a>Filters</h5>
<div class="paragraph">
<p>Keep records that match a SpEL boolean expression.</p>
</div>
<div class="paragraph">
<p>For example this filter will only keep records where the <code>value</code> field is a series of digits:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> import --filter "value matches '\\d+'" ...</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_redisearch"><a class="anchor" href="#_redisearch"></a>4.2.3. RediSearch</h4>
<div class="paragraph">
<p>You can infer generator fields from a RediSearch index using the <code>--infer</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-gen import --infer beerIdx hset --keyspace beer --keys id</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_faker_fields"><a class="anchor" href="#_faker_fields"></a>4.3. Faker Fields</h3>
<div class="paragraph">
<p>Run this command to display the list of available Faker providers:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> faker-help</pre>
</div>
</div>
<div class="paragraph">
<p>Most providers don&#8217;t take any arguments and can be called directly, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> import firstName="name.firstName"</pre>
</div>
</div>
<div class="paragraph">
<p>Some providers take parameters, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-gen</span> import lease="number.digits(2)"</pre>
</div>
</div>
<div class="paragraph">
<p>Refer to the link specified for each provider for complete documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_riot_redis"><a class="anchor" href="#_riot_redis"></a>5. RIOT Redis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most database migration tools available today are offline in nature. Migrating data from AWS ElastiCache to Redis Enterprise Cloud for example means backing up your Elasticache data to an AWS S3 bucket and importing it into Redis Enterprise Cloud using its UI.</p>
</div>
<div class="paragraph">
<p>RIOT Redis is a migration tool that allows for live data migration between any Redis databases.</p>
</div>
<div class="paragraph">
<p>RIOT Redis does not make use of the <a href="https://redis.io/commands/replicaof">REPLICAOF</a> command which is not always available (see <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/RestrictedCommands.html">ElastiCache restrictions</a>). Instead it implements client-side replication using DUMP and RESTORE:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/replication.png" alt="replication">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Key reader: initiates a SCAN and optionally calls SUBSCRIBE to listen for keyspace notifications (live replication).</p>
</li>
<li>
<p>Value reader: takes the keys and calls DUMP and TTL.</p>
</li>
<li>
<p>Key/Value writer: takes key/value/ttl tuples and calls RESTORE and EXPIRE.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_getting_started_4"><a class="anchor" href="#_getting_started_4"></a>5.1. Getting Started</h3>
<div class="sect3">
<h4 id="_install_4"><a class="anchor" href="#_install_4"></a>5.1.1. Install</h4>
<div class="paragraph">
<p>RIOT Redis can be installed in different ways depending on your environment and preference.</p>
</div>
<div class="sect4">
<h5 id="_download_and_run_4"><a class="anchor" href="#_download_and_run_4"></a>Download and Run</h5>
<div class="paragraph">
<p>Download the <a href="https://github.com/redis-developer/riot/releases/latest">latest release</a>, unzip and copy to the desired location.</p>
</div>
<div class="paragraph">
<p>Launch the <code>bin/riot-redis</code> script and follow the usage information provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="_homebrew_macos_4"><a class="anchor" href="#_homebrew_macos_4"></a>Homebrew (macOS)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">brew install redis-developer/tap/riot-redis</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_scoop_windows_4"><a class="anchor" href="#_scoop_windows_4"></a>Scoop (Windows)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">scoop bucket add redis-developer https://github.com/redis-developer/scoop.git
scoop install riot-redis</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_clone_and_run_4"><a class="anchor" href="#_clone_and_run_4"></a>Clone and run</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">git clone https://github.com/redis-developer/riot.git
cd riot/bin
./riot-redis</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage_4"><a class="anchor" href="#_usage_4"></a>5.1.2. Usage</h4>
<div class="paragraph">
<p>To display usage help, run the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-redis</span> --help
Usage: <strong>riot-redis</strong> [OPTIONS] [COMMAND]
  <span class="olive">-H</span>, <span class="olive">--help</span>                Show this help message and exit
  <span class="olive">-V</span>, <span class="olive">--version</span>             Print version information and exit.
  <span class="olive">-q</span>, <span class="olive">--quiet</span>               Log errors only.
  <span class="olive">-w</span>, <span class="olive">--warn</span>                Set log level to warn.
  <span class="olive">-i</span>, <span class="olive">--info</span>                Set log level to info.
  <span class="olive">-d</span>, <span class="olive">--debug</span>               Log in debug mode (includes normal stacktrace).
      <span class="olive">--stacktrace</span>          Print out the stacktrace for all exceptions.
Redis connection options
  <span class="olive">-h</span>, <span class="olive">--hostname</span>=&lt;host&gt;     Server hostname (default: localhost).
  <span class="olive">-p</span>, <span class="olive">--port</span>=&lt;port&gt;         Server port (default: 6379).
  <span class="olive">-s</span>, <span class="olive">--socket</span>=&lt;socket&gt;     Server socket (overrides hostname and port).
      <span class="olive">--user</span>=&lt;name&gt;         Used to send ACL style 'AUTH username pass'. Needs password.
  <span class="olive">-a</span>, <span class="olive">--pass</span>[=&lt;password&gt;]   Password to use when connecting to the server.
  <span class="olive">-u</span>, <span class="olive">--uri</span>=&lt;uri&gt;...        Server URI.
      --timeout=&lt;sec&gt;       Redis command timeout (default: 60).
  <span class="olive">-n</span>, <span class="olive">--db</span>=&lt;db&gt;             Database number (default: 0).
  <span class="olive">-c</span>, <span class="olive">--cluster</span>             Enable cluster mode.
      <span class="olive">--tls</span>                 Establish a secure TLS connection.
      <span class="olive">--[no-]verify-peer</span>    Verify peers when using TLS. True by default.
      <span class="olive">--latency</span>             Show latency metrics.
      <span class="olive">--pool-max</span>=&lt;int&gt;      Max pool connections (default: 8).
      <span class="olive">--client</span>=&lt;name&gt;       Client name used to connect to Redis.
Commands:
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>Redis connection options are the same as <code>redis-cli</code>.</p>
</div>
<div class="paragraph">
<p>For Redis URI syntax see <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details#uri-syntax">here</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use <code>--help</code> on any subcommand:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-redis</span> import --help
<span class="green">riot-redis</span> import hset --help</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_replicating"><a class="anchor" href="#_replicating"></a>5.2. Replicating</h3>
<div class="paragraph">
<p>The <code>replicate</code> command reads data from a source Redis database and writes it to a target Redis database. The general usage is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-redis</span> -h &lt;src host&gt; -p &lt;src port&gt; replicate -h &lt;dest host&gt; -p &lt;dest port&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>To show the full usage, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-redis</span> replicate --help</pre>
</div>
</div>
<div class="sect3">
<h4 id="_type_based_replication"><a class="anchor" href="#_type_based_replication"></a>5.2.1. Type-Based Replication</h4>
<div class="paragraph">
<p>RIOT Redis 2.8 introduced another replication command called <code>replicate-ds</code> that uses data structure-specific producers and consumers. Each Redis data structure type has a corresponding pair of read/write commands:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Read</th>
<th class="tableblock halign-left valign-top">Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HGETALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HSET</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LRANGE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RPUSH</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMEMBERS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SADD</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorted Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ZRANGE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ZADD</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XRANGE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XADD</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SET</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This replication strategy is more intensive in terms of CPU, memory, and network for the machines running RIOT Redis. Adjust number of threads, batch, and queue sizes accordingly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_verification"><a class="anchor" href="#_verification"></a>5.2.2. Verification</h4>
<div class="paragraph">
<p>Once replication is complete (i.e. for snapshot replication when scan is complete, for live replication when no keyspace notification idle) RIOT Redis will perform a verification step. This step iterates over keys in the source database and compares values and TTLs between source and target databases. The output looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt;1,234 T2,345 ≠3,456 ⧗4,567 &lt;5,678</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&gt;</code>: # keys only present in source database</p>
</li>
<li>
<p><code>T</code>: # mismatched data structure types</p>
</li>
<li>
<p><code>≠</code>: # mismatched values</p>
</li>
<li>
<p><code>⧗</code>: # keys with TTL delta greater than tolerance</p>
</li>
<li>
<p><code>&lt;</code>: # keys only present in target database</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_architecture"><a class="anchor" href="#_architecture"></a>5.3. Architecture</h3>
<div class="paragraph">
<p>RIOT Redis follows a producer/consumer approach.</p>
</div>
<div class="sect3">
<h4 id="_producer"><a class="anchor" href="#_producer"></a>5.3.1. Producer</h4>
<div class="paragraph">
<p>The producer is connected to the source Redis (e.g. ElastiCache) database and iterates over keys to be replicated by performing a SCAN and reading the corresponding values with DUMP. This is the snapshot part of the replication process.</p>
</div>
<div class="paragraph">
<p>If live replication is enabled the producer also subscribes to keyspace notifications to generate a continuous stream of keys and corresponding values.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Make sure the source Redis database has keyspace notifications enabled using <code>notify-keyspace-events = KA</code> in <code>redis.conf</code> or via CONFIG SET.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The live replication mechanism does not guarantee data consistency. Redis sends keyspace notifications over pub/sub which does not provide	guaranteed delivery. It is possible that RIOT Redis can miss some notifications in case of network failures for example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both snapshot and live producer processes make use of <a href="https://redis.io/topics/pipelining">pipelining</a> in order to read values in a batch fashion. Use the <code>--reader-batch</code> option to configure the number of values to be read in a single pipelined call. Each process can be multi-threaded using the <code>--reader-threads</code> option.</p>
</div>
</div>
<div class="sect3">
<h4 id="_consumer"><a class="anchor" href="#_consumer"></a>5.3.2. Consumer</h4>
<div class="paragraph">
<p>The consumer is responsible for ingesting the keys and values generated by the producer and writing them to the target Redis database (e.g. Redis Enterprise Cloud). For each key/value pair it issues a RESTORE command.</p>
</div>
<div class="paragraph">
<p>The consumer process also makes use of <a href="https://redis.io/topics/pipelining">pipelining</a> in order to write values in a batch fashion. Use the <code>--batch</code> option to configure the number of values to be written in a single pipelined call.</p>
</div>
<div class="paragraph">
<p>Like the consumer the producer process can be multi-threaded, using the <code>--threads</code> option.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_riot_stream"><a class="anchor" href="#_riot_stream"></a>6. RIOT Stream</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RIOT Stream lets you import and export data from Kafka topics.</p>
</div>
<div class="sect2">
<h3 id="_getting_started_5"><a class="anchor" href="#_getting_started_5"></a>6.1. Getting Started</h3>
<div class="sect3">
<h4 id="_install_5"><a class="anchor" href="#_install_5"></a>6.1.1. Install</h4>
<div class="paragraph">
<p>RIOT Stream can be installed in different ways depending on your environment and preference.</p>
</div>
<div class="sect4">
<h5 id="_download_and_run_5"><a class="anchor" href="#_download_and_run_5"></a>Download and Run</h5>
<div class="paragraph">
<p>Download the <a href="https://github.com/redis-developer/riot/releases/latest">latest release</a>, unzip and copy to the desired location.</p>
</div>
<div class="paragraph">
<p>Launch the <code>bin/riot-stream</code> script and follow the usage information provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="_homebrew_macos_5"><a class="anchor" href="#_homebrew_macos_5"></a>Homebrew (macOS)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">brew install redis-developer/tap/riot-stream</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_scoop_windows_5"><a class="anchor" href="#_scoop_windows_5"></a>Scoop (Windows)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">scoop bucket add redis-developer https://github.com/redis-developer/scoop.git
scoop install riot-stream</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_clone_and_run_5"><a class="anchor" href="#_clone_and_run_5"></a>Clone and run</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">git clone https://github.com/redis-developer/riot.git
cd riot/bin
./riot-stream</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage_5"><a class="anchor" href="#_usage_5"></a>6.1.2. Usage</h4>
<div class="paragraph">
<p>To display usage help, run the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-stream</span> --help
Usage: <strong>riot-stream</strong> [OPTIONS] [COMMAND]
  <span class="olive">-H</span>, <span class="olive">--help</span>                Show this help message and exit
  <span class="olive">-V</span>, <span class="olive">--version</span>             Print version information and exit.
  <span class="olive">-q</span>, <span class="olive">--quiet</span>               Log errors only.
  <span class="olive">-w</span>, <span class="olive">--warn</span>                Set log level to warn.
  <span class="olive">-i</span>, <span class="olive">--info</span>                Set log level to info.
  <span class="olive">-d</span>, <span class="olive">--debug</span>               Log in debug mode (includes normal stacktrace).
      <span class="olive">--stacktrace</span>          Print out the stacktrace for all exceptions.
Redis connection options
  <span class="olive">-h</span>, <span class="olive">--hostname</span>=&lt;host&gt;     Server hostname (default: localhost).
  <span class="olive">-p</span>, <span class="olive">--port</span>=&lt;port&gt;         Server port (default: 6379).
  <span class="olive">-s</span>, <span class="olive">--socket</span>=&lt;socket&gt;     Server socket (overrides hostname and port).
      <span class="olive">--user</span>=&lt;name&gt;         Used to send ACL style 'AUTH username pass'. Needs password.
  <span class="olive">-a</span>, <span class="olive">--pass</span>[=&lt;password&gt;]   Password to use when connecting to the server.
  <span class="olive">-u</span>, <span class="olive">--uri</span>=&lt;uri&gt;...        Server URI.
      --timeout=&lt;sec&gt;       Redis command timeout (default: 60).
  <span class="olive">-n</span>, <span class="olive">--db</span>=&lt;db&gt;             Database number (default: 0).
  <span class="olive">-c</span>, <span class="olive">--cluster</span>             Enable cluster mode.
      <span class="olive">--tls</span>                 Establish a secure TLS connection.
      <span class="olive">--[no-]verify-peer</span>    Verify peers when using TLS. True by default.
      <span class="olive">--latency</span>             Show latency metrics.
      <span class="olive">--pool-max</span>=&lt;int&gt;      Max pool connections (default: 8).
      <span class="olive">--client</span>=&lt;name&gt;       Client name used to connect to Redis.
Commands:
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>Redis connection options are the same as <code>redis-cli</code>.</p>
</div>
<div class="paragraph">
<p>For Redis URI syntax see <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details#uri-syntax">here</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use <code>--help</code> on any subcommand:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-stream</span> import --help
<span class="green">riot-stream</span> import hset --help</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_importing_4"><a class="anchor" href="#_importing_4"></a>6.2. Importing</h3>
<div class="paragraph">
<p>The <code>import</code> command reads messages from a Kafka topic and writes them to a Redis stream. The general usage is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-stream</span> -h &lt;redis host&gt; -p &lt;redis port&gt; import --broker &lt;host:port&gt; <span class="olive">TOPIC</span>...</pre>
</div>
</div>
<div class="paragraph">
<p>To show the full usage, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-stream</span> import --help</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Import example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-stream import topic1 --broker localhost:9092</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporting_3"><a class="anchor" href="#_exporting_3"></a>6.3. Exporting</h3>
<div class="paragraph">
<p>The <code>export</code> command reads message from a Redis stream and writes them to a Kafka topic. The general usage is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-stream</span> -h &lt;redis host&gt; -p &lt;redis port&gt; export --broker &lt;host:port&gt; <span class="olive">STREAM</span>...</pre>
</div>
</div>
<div class="paragraph">
<p>To show the full usage, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><span class="green">riot-stream</span> export --help</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Export example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">riot-stream export stream1 --idle-timeout 500 --broker localhost:9092</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.12.1-SNAPSHOT<br>
Last updated 2021-07-08 00:04:38 +0200
</div>
</div>
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</body>
</html>